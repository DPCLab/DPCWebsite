var resizeId;function generateTooltipMultiline(t){var e="",a=t.title;t.responses=t.responses.map(function(e,a){return{data:e,color:t.colors[a]}});for(var s=0;s<t.responses.length;s++)e+="<div class = 'bubble' style = 'background:"+t.responses[s].color+"'></div> <span>"+t.labels[s]+": "+t.responses[s].data.toFixed(2)+"</span><br>";return"object"==typeof t.title&&(a=1==t.responses.length?"11/"+a.getDate()+" "+(a.getHours()%12==0?12:a.getHours()%12)+":00"+(a.getHours()>=12?"PM":"AM"):a.getMonth()+1+"/"+a.getFullYear()),"<h4>"+a+"</h4>"+e}d3.select(window).on("resize",function(){resizeId=setTimeout(function(){d3.selectAll(".line_chart").each(function(t,e){d3.select(this);var a=d3.select("#body").node().offsetWidth-margin.left-margin.right,s=parseInt(this.dataset.height)-margin.top-margin.bottom;drawGraph(this,dataForGraphs[e],a,s,this.dataset.accent,bisectors[e],this.dataset.x,this.dataset.y,this.dataset.scatter,this.dataset.lines,this.dataset.accent.split(","),this.dataset.ordinal)})},500)});var margin={top:50,right:40,bottom:50,left:60},graphLength=d3.selectAll(".line_chart").size(),dataForGraphs=new Array(graphLength),bisectors=new Array(graphLength);function drawGraph(t,e,a,s,r,n,l,i,o,d,c,h){var p=d3.select(t),f=d3.select(t.firstChild),m=t.dataset.usetooltip;p.select("svg").selectAll("*").remove();var y=d3.scaleLinear().range([0,a]);h&&(y=d3.scaleTime().range([0,a]));for(var g=d3.scaleLinear().rangeRound([s,0]),x=[],u=0;u<d;u++)x.push(d3.line().x(function(t){return y(t.x)}).y(function(t){return g(t.y[u])}));h?(y.domain(d3.extent(e,function(t){return t.x})),g.domain([t.dataset.hours?-.6:-.4,t.dataset.hours?.6:.8])):(y.domain([-1.2,1.2]),g.domain([0,d3.max(e,function(t){return d3.max(t.y)})]),y.invert=d3.scaleQuantize().domain(y.range()).range(y.domain()));var b=p.select("svg").attr("width",a+margin.left+margin.right).attr("height",s+margin.top+margin.bottom).on("mousemove",function(){if(m){var a=p.select(".position-line"),r=y.invert(d3.mouse(this)[0]-margin.left),l=e[n(e,r)];if(null!=l){f.style("top",s-90+margin.top+"px").classed("hidden",!1).html(generateTooltipMultiline({title:l.x,responses:l.y,colors:c,labels:t.dataset.labels.split(",")})).style("left",(f.node().offsetWidth+d3.mouse(this)[0]+30>d3.select("#body").node().offsetWidth?y(l.x)+margin.left-10-f.node().offsetWidth:y(l.x)+margin.left+10)+"px"),a.attr("x1",y(l.x)+margin.left).attr("x2",y(l.x)+margin.left).classed("hidden",!1);for(var i=0;i<d;i++)d3.select(t).select(".dot-"+i).attr("cx",y(l.x)).attr("cy",g(l.y[i])).classed("hidden",!1)}else f.classed("hidden",!0),a.classed("hidden",!0),b.selectAll(".dot").classed("hidden",!0)}}).on("mouseout",function(t){var e=p.select(".position-line");f.classed("hidden",!0),e.classed("hidden",!0),b.selectAll(".dot").classed("hidden",!0)}).append("g").attr("transform","translate("+margin.left+","+margin.top+")");p.select("svg").append("line").attr("class","position-line hidden").attr("x1",y(0)).attr("y1",g(h?t.dataset.hours?-.6:-.4:0)+margin.top).attr("x2",y(0)).attr("y2",g(h?t.dataset.hours?.6:.8:1)+margin.top).style("stroke","black").style("stroke-width","1").style("stroke-dasharray","5,5"),h&&b.append("line").attr("class","mean-line").attr("x1",y(e[0].x)).attr("x2",y(e[e.length-1].x)).attr("y1",g(0)+1).attr("y2",g(0)+1).style("stroke","#ccc").style("stroke-dasharray","1");for(u=0;u<d;u++)b.append("path").data([e]).attr("class","line").style("stroke",c[u]).style("stroke-width","2px").style("fill","none").attr("d",x[u]),b.append("circle").attr("class","dot-"+u+" dot hidden").style("fill",c[u]).attr("r",5);h?b.append("g").style("font-family","IBM_Plex_Sans").style("font-size","14px").attr("transform","translate(0,"+s+")").call(d3.axisBottom(y).tickFormat(d3.timeFormat(t.dataset.hours?"11/%d %I:00%p":"%m/%Y")).ticks(4)).selectAll("text").attr("y",15).attr("x",15).attr("dy",".35em").attr("transform","rotate(-15)").style("text-anchor","end"):b.append("g").style("font-family","IBM_Plex_Sans").style("font-size","14px").attr("transform","translate(0,"+s+")").call(d3.axisBottom(y).ticks(4)),b.append("text").attr("transform","translate("+a/2+" ,-20)").style("text-anchor","middle").style("font-family","IBM_Plex_Sans").style("font-size","14px").style("font-weight","bold").text(t.dataset.title),b.append("g").style("font-family","IBM_Plex_Sans").style("font-size","14px").call(d3.axisLeft(g).ticks(5)),b.append("text").attr("transform","rotate(-90)").attr("y",0-margin.left).attr("x",0-s/2).attr("dy","1em").style("text-anchor","middle").style("font-family","IBM_Plex_Sans").style("font-size","14px").text(i),b.append("text").attr("transform","translate("+a/2+" ,"+(s+45)+")").style("text-anchor","middle").style("font-family","IBM_Plex_Sans").style("font-size","14px").text(l),console.log(t.id),console.log("sentiment-no-spike"==t.id),"sentiment-no-spike"==t.id&&(console.log("te"),b.append("rect").attr("x",y(-.1)).attr("y",0).attr("width",y(.1)-y(-.1)).attr("height",s).attr("fill","#f8f8f8"),b.append("line").attr("x1",y(-.1)).attr("x2",y(-.1)).attr("y1",0).attr("y2",s).style("stroke","#cbcbcb").style("stroke-width","3").style("stroke-dasharray","5,5"),b.append("line").attr("x1",y(.1)).attr("x2",y(.1)).attr("y1",0).attr("y2",s).style("stroke","#cbcbcb").style("stroke-width","3").style("stroke-dasharray","5,5"))}d3.selectAll(".line_chart").each(function(t,e){var a=this.dataset.accent,s=a.split(","),r=d3.select(this),n=this,l=this.dataset.csv,i=this.dataset.x,o=this.dataset.y,d=this.dataset.lines,c=this,h=[];$.ajax({url:l,success:function(t){t.split("\n").map(function(t){var e=t.split(",");if(e[0]){var a=d3.timeParse("%m/%Y");c.dataset.hours&&(a=d3.timeParse("%d %H")),h.push({x:c.dataset.ordinal?a(e[0]):parseFloat(e[0]),y:e.slice(1).map(function(t){return parseFloat(t)})})}});var l=d3.bisector(function(t){return t.x}).right;dataForGraphs[e]=h,bisectors[e]=l;var p=d3.select("#body").node().offsetWidth-margin.left-margin.right,f=parseInt(n.dataset.height)-margin.top-margin.bottom;if(r.append("svg"),drawGraph(c,h,p,f,a,l,i,o,n.dataset.scatter,d,s,n.dataset.ordinal),d>1){var m=n.dataset.labels.split(",");d3.select(n).append("div").attr("class","line-label").attr("width","100%").style("font-size","14px").selectAll("p").data(s).enter().append("p").html(function(t,e){return"<div class = 'bubble' style = 'background:"+t+"'></div> "+m[e]})}},dataType:"text"})});