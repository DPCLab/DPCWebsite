var resizeId;function generateTooltipMultiline(t){var e="",a=t.title;t.responses=t.responses.map(function(e,a){return{data:e,color:t.colors[a]}});for(var s=0;s<t.responses.length;s++)e+="<div class = 'bubble' style = 'background:"+t.responses[s].color+"'></div> <span>"+t.labels[s]+": "+t.responses[s].data.toFixed(2)+"</span><br>";return"object"==typeof t.title&&(a=a.getMonth()+1+"/"+a.getFullYear()),"<h4>"+a+"</h4>"+e}d3.select(window).on("resize",function(){resizeId=setTimeout(function(){d3.selectAll(".line_chart").each(function(t,e){d3.select(this);var a=d3.select("#body").node().offsetWidth-margin.left-margin.right,s=parseInt(this.dataset.height)-margin.top-margin.bottom;drawGraph(this,dataForGraphs[e],a,s,this.dataset.accent,bisectors[e],this.dataset.x,this.dataset.y,this.dataset.scatter,this.dataset.lines,this.dataset.accent.split(","),this.dataset.ordinal)})},500)});var margin={top:20,right:40,bottom:50,left:60},graphLength=d3.selectAll(".line_chart").size(),dataForGraphs=new Array(graphLength),bisectors=new Array(graphLength);function drawGraph(t,e,a,s,n,r,i,l,d,o,c,p){var h=d3.select(t),f=d3.select(t.firstChild),m=t.dataset.usetooltip;h.select("svg").selectAll("*").remove();var g=d3.scaleLinear().range([0,a]);p&&(g=d3.scaleTime().range([0,a]));for(var y=d3.scaleLinear().rangeRound([s,0]),x=[],u=0;u<o;u++)x.push(d3.line().x(function(t){return g(t.x)}).y(function(t){return y(t.y[u])}));p?(g.domain(d3.extent(e,function(t){return t.x})),y.domain([-.4,.8])):(g.domain([-1.2,1.2]),y.domain([0,d3.max(e,function(t){return d3.max(t.y)})]),g.invert=d3.scaleQuantize().domain(g.range()).range(g.domain()));var v=h.select("svg").attr("width",a+margin.left+margin.right).attr("height",s+margin.top+margin.bottom).on("mousemove",function(){if(m){var a=h.select(".position-line"),n=g.invert(d3.mouse(this)[0]-margin.left),i=e[r(e,n)];if(null!=i){f.style("top",s-90+margin.top+"px").classed("hidden",!1).html(generateTooltipMultiline({title:i.x,responses:i.y,colors:c,labels:t.dataset.labels.split(",")})).style("left",(f.node().offsetWidth+d3.mouse(this)[0]+30>d3.select("#body").node().offsetWidth?g(i.x)+margin.left-10-f.node().offsetWidth:g(i.x)+margin.left+10)+"px"),a.attr("x1",g(i.x)+margin.left).attr("x2",g(i.x)+margin.left).classed("hidden",!1);for(var l=0;l<o;l++)d3.select(t).select(".dot-"+l).attr("cx",g(i.x)).attr("cy",y(i.y[l])).classed("hidden",!1)}else f.classed("hidden",!0),a.classed("hidden",!0),v.selectAll(".dot").classed("hidden",!0)}}).on("mouseout",function(t){var e=h.select(".position-line");f.classed("hidden",!0),e.classed("hidden",!0),v.selectAll(".dot").classed("hidden",!0)}).append("g").attr("transform","translate("+margin.left+","+margin.top+")");h.select("svg").append("line").attr("class","position-line hidden").attr("x1",g(0)).attr("y1",y(p?-.4:0)+margin.top).attr("x2",g(0)).attr("y2",y(p?.8:1)+margin.top).style("stroke","black").style("stroke-width","1").style("stroke-dasharray","5,5"),p&&v.append("line").attr("class","mean-line").attr("x1",g(e[0].x)).attr("x2",g(e[e.length-1].x)).attr("y1",y(0)+1).attr("y2",y(0)+1).style("stroke","#ccc").style("stroke-dasharray","1");for(u=0;u<o;u++)v.append("path").data([e]).attr("class","line").style("stroke",c[u]).style("stroke-width","2px").style("fill","none").attr("d",x[u]),v.append("circle").attr("class","dot-"+u+" dot hidden").style("fill",c[u]).attr("r",5);p?v.append("g").style("font-family","IBM_Plex_Sans").style("font-size","14px").attr("transform","translate(0,"+s+")").call(d3.axisBottom(g).tickFormat(d3.timeFormat("%m/%Y"))):v.append("g").style("font-family","IBM_Plex_Sans").style("font-size","14px").attr("transform","translate(0,"+s+")").call(d3.axisBottom(g).ticks(4)),v.append("g").style("font-family","IBM_Plex_Sans").style("font-size","14px").call(d3.axisLeft(y).ticks(5)),v.append("text").attr("transform","rotate(-90)").attr("y",0-margin.left).attr("x",0-s/2).attr("dy","1em").style("text-anchor","middle").style("font-family","IBM_Plex_Sans").style("font-size","14px").style("font-weight","bold").text(l),v.append("text").attr("transform","translate("+a/2+" ,"+(s+margin.top+20)+")").style("text-anchor","middle").style("font-family","IBM_Plex_Sans").style("font-size","14px").style("font-weight","bold").text(i)}d3.selectAll(".line_chart").each(function(t,e){var a=this.dataset.accent,s=a.split(","),n=d3.select(this),r=this,i=this.dataset.csv,l=this.dataset.x,d=this.dataset.y,o=this.dataset.lines,c=this,p=[];$.ajax({url:i,success:function(t){t.split("\n").map(function(t){var e=t.split(",");if(e[0]){var a=d3.timeParse("%m/%Y");p.push({x:c.dataset.ordinal?a(e[0]):parseFloat(e[0]),y:e.slice(1).map(function(t){return parseFloat(t)})})}});var i=d3.bisector(function(t){return t.x}).right;dataForGraphs[e]=p,bisectors[e]=i;var h=d3.select("#body").node().offsetWidth-margin.left-margin.right,f=parseInt(r.dataset.height)-margin.top-margin.bottom;if(n.append("svg"),drawGraph(c,p,h,f,a,i,l,d,r.dataset.scatter,o,s,r.dataset.ordinal),o>1){var m=r.dataset.labels.split(",");d3.select(r).append("div").attr("class","line-label").attr("width","100%").style("font-size","14px").selectAll("p").data(s).enter().append("p").html(function(t,e){return"<div class = 'bubble' style = 'background:"+t+"'></div> "+m[e]})}},dataType:"text"})});