var resizeId;function generateTooltipMultiline(t){var e="",a=t.title;t.responses=t.responses.map(function(e,a){return{data:e,color:t.colors[a]}});for(var s=0;s<t.responses.length;s++)e+="<div class = 'bubble' style = 'background:"+t.responses[s].color+"'></div> <span>"+t.labels[s]+": "+t.responses[s].data.toFixed(2)+"</span><br>";return"object"==typeof t.title&&(a=a.getMonth()+1+"/"+a.getFullYear()),"<h4>"+a+"</h4>"+e}d3.select(window).on("resize",function(){resizeId=setTimeout(function(){d3.selectAll(".line_chart").each(function(t,e){d3.select(this);var a=d3.select("#body").node().offsetWidth-margin.left-margin.right,s=parseInt(this.dataset.height)-margin.top-margin.bottom;drawGraph(this,dataForGraphs[e],a,s,this.dataset.accent,d3.select(this.firstChild),bisectors[e],this.dataset.x,this.dataset.y,this.dataset.scatter,this.dataset.lines,this.dataset.accent.split(","),this.dataset.ordinal)})},500)});var margin={top:20,right:40,bottom:50,left:60},graphLength=d3.selectAll(".line_chart").size(),dataForGraphs=new Array(graphLength),bisectors=new Array(graphLength);function drawGraph(t,e,a,s,n,r,i,l,o,d,c,h,p){var f=d3.select(t);f.select("svg").selectAll("*").remove();var m=d3.scalePoint().rangeRound([0,a]).padding(.1);p&&(m=d3.scaleTime().range([0,a]));for(var g=d3.scaleLinear().rangeRound([s,0]),u=[],y=0;y<c;y++)u.push(d3.line().x(function(t){return m(t.x)}).y(function(t){return g(t.y[y])}));p?(m.domain(d3.extent(e,function(t){return t.x})),g.domain([-1,1])):(m.domain(e.map(function(t){return""+t.x})),g.domain([0,d3.max(e,function(t){return d3.max(t.y)})]),m.invert=d3.scaleQuantize().domain(m.range()).range(m.domain()));var x=f.select("svg").attr("width",a+margin.left+margin.right).attr("height",s+margin.top+margin.bottom).on("mouseover",function(){var a=m.invert(d3.mouse(this)[0]-margin.left),s=e[i(e,a)];null!=s?r.style("left",m(s.x)+margin.left-Math.round(r.node().offsetWidth/2)+"px").style("top",g(d3.max(s.y))-Math.round(r.node().offsetHeight)-12+margin.top+"px").classed("hidden",!1).html(generateTooltipMultiline({title:s.x,responses:s.y,colors:h,labels:t.dataset.labels.split(",")})):r.classed("hidden",!0).html("")}).on("mouseout",function(t){console.log("yo"),r.classed("hidden",!0)}).append("g").attr("transform","translate("+margin.left+","+margin.top+")");p&&x.append("line").attr("class","mean-line").attr("x1",m(e[0].x)).attr("x2",m(e[e.length-1].x)).attr("y1",g(0)+1).attr("y2",g(0)+1).style("stroke","#ccc").style("stroke-dasharray","1");for(y=0;y<c;y++)x.append("path").data([e]).attr("class","line").style("stroke",h[y]).style("stroke-width","2px").style("fill","none").attr("d",u[y]);p?x.append("g").style("font-family","IBM_Plex_Sans").style("font-size","14px").attr("transform","translate(0,"+s+")").call(d3.axisBottom(m).tickFormat(d3.timeFormat("%m/%Y"))):x.append("g").style("font-family","IBM_Plex_Sans").style("font-size","14px").attr("transform","translate(0,"+s+")").call(d3.axisBottom(d3.scalePoint().domain([-1,0,1]).rangeRound([0,a]))),x.append("g").style("font-family","IBM_Plex_Sans").style("font-size","14px").call(d3.axisLeft(g).ticks(5)),x.append("text").attr("transform","rotate(-90)").attr("y",0-margin.left).attr("x",0-s/2).attr("dy","1em").style("text-anchor","middle").style("font-family","IBM_Plex_Sans").style("font-size","14px").style("font-weight","bold").text(o),x.append("text").attr("transform","translate("+a/2+" ,"+(s+margin.top+20)+")").style("text-anchor","middle").style("font-family","IBM_Plex_Sans").style("font-size","14px").style("font-weight","bold").text(l)}d3.selectAll(".line_chart").each(function(t,e){var a=this.dataset.accent,s=a.split(","),n=d3.select(this),r=this,i=this.dataset.csv,l=this.dataset.x,o=this.dataset.y,d=d3.select(this.firstChild),c=this.dataset.lines,h=this,p=[];$.ajax({url:i,success:function(t){t.split("\n").map(function(t){var e=t.split(",");if(e[0]){var a=d3.timeParse("%m/%Y");p.push({x:h.dataset.ordinal?a(e[0]):e[0],y:e.slice(1).map(function(t){return parseFloat(t)})})}});var i=d3.bisector(function(t){return t.x}).right;dataForGraphs[e]=p,bisectors[e]=i;var f=d3.select("#body").node().offsetWidth-margin.left-margin.right,m=parseInt(r.dataset.height)-margin.top-margin.bottom;if(n.append("svg"),drawGraph(h,p,f,m,a,d,i,l,o,r.dataset.scatter,c,s,r.dataset.ordinal),c>1){var g=r.dataset.labels.split(",");d3.select(r).append("div").attr("class","line-label").attr("width","100%").style("font-size","14px").selectAll("p").data(s).enter().append("p").html(function(t,e){return"<div class = 'bubble' style = 'background:"+t+"'></div> "+g[e]+"<br>"})}},dataType:"text"})});